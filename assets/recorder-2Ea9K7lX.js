import{A as o,N as n}from"./Navigation-BNncwhjL.js";import{s as d}from"./AudioResourceManager-DnsOnIC-.js";class h{constructor(){this.mediaRecorder=null,this.audioChunks=[],this.isRecording=!1,this.recordedAudio=null,this.stream=null,this.recordBtn=document.getElementById("record-btn"),this.stopBtn=document.getElementById("stop-btn"),this.playBtn=document.getElementById("play-btn"),this.saveBtn=document.getElementById("save-btn"),this.statusDisplay=document.getElementById("recorder-status"),this.timerDisplay=document.getElementById("recorder-timer"),this.startTime=0,this.timerInterval=null,this.boundBeforeUnload=()=>this.dispose(),this.init()}init(){this.recordBtn&&this.recordBtn.addEventListener("click",()=>this.startRecording()),this.stopBtn&&this.stopBtn.addEventListener("click",()=>this.stopRecording()),this.playBtn&&this.playBtn.addEventListener("click",()=>this.playRecording()),this.saveBtn&&this.saveBtn.addEventListener("click",()=>this.saveRecording()),this.stopBtn&&(this.stopBtn.disabled=!0),this.updateStatus("Ready to record"),window.addEventListener("beforeunload",this.boundBeforeUnload)}async startRecording(){if(!this.isRecording)try{this.stream=await navigator.mediaDevices.getUserMedia({audio:!0}),this.mediaRecorder=new MediaRecorder(this.stream),this.audioChunks=[],this.mediaRecorder.ondataavailable=t=>{this.audioChunks.push(t.data)},this.mediaRecorder.onstop=()=>{const t=new Blob(this.audioChunks,{type:"audio/wav"});this.recordedAudio=URL.createObjectURL(t),this.updateStatus("Recording complete"),this.stopTimer(),this.cleanupStream()},this.mediaRecorder.start(),this.isRecording=!0,this.updateStatus("Recording..."),this.startTimer(),this.recordBtn&&(this.recordBtn.disabled=!0),this.stopBtn&&(this.stopBtn.disabled=!1)}catch(t){console.error("Error starting recording:",t),this.updateStatus("Error: Microphone access denied"),this.cleanupStream()}}stopRecording(){this.mediaRecorder&&this.isRecording&&(this.mediaRecorder.stop(),this.isRecording=!1,this.recordBtn&&(this.recordBtn.disabled=!1),this.stopBtn&&(this.stopBtn.disabled=!0)),this.cleanupStream()}playRecording(){if(this.recordedAudio){const t=new Audio(this.recordedAudio);t.play(),this.updateStatus("Playing..."),t.onended=()=>{this.updateStatus("Playback complete")}}else this.updateStatus("No recording to play")}saveRecording(){if(this.recordedAudio){const t=document.createElement("a");t.href=this.recordedAudio,t.download=`recording_${new Date().getTime()}.wav`,t.click(),this.updateStatus("Recording saved")}else this.updateStatus("No recording to save")}startTimer(){this.startTime=Date.now(),this.timerInterval=setInterval(()=>{const t=Date.now()-this.startTime,e=Math.floor(t/6e4),s=Math.floor(t%6e4/1e3),r=Math.floor(t%1e3/10),a=`${e.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}.${r.toString().padStart(2,"0")}`;this.timerDisplay&&(this.timerDisplay.textContent=a)},10)}stopTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null)}updateStatus(t){this.statusDisplay&&(this.statusDisplay.textContent=t)}cleanupStream(){this.stream&&(d(this.stream),this.stream=null)}dispose(){this.isRecording&&this.stopRecording(),this.cleanupStream(),this.stopTimer(),window.removeEventListener("beforeunload",this.boundBeforeUnload),[this.recordBtn,this.stopBtn,this.playBtn,this.saveBtn].forEach(t=>{if(!t)return;const e=t.cloneNode(!0);t.replaceWith(e)})}}document.addEventListener("DOMContentLoaded",()=>{new o().init(),new n,new h});
