import{N as l}from"./Navigation-Ct1b79JU.js";class h{constructor(e={}){this.audioContext=null,this.currentExercise=null,this.score=0,this.totalAttempts=0,this.progress=new Map,this.difficulty="easy",this.exerciseType="interval",this.options={tempo:120,volume:.5,...e},this.init()}async init(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),console.log("EarTraining: AudioContext initialized")}catch(e){console.error("EarTraining: Failed to initialize AudioContext:",e)}}generateExercise(e="interval",t="easy"){this.exerciseType=e,this.difficulty=t;const s={interval:()=>this.generateIntervalExercise(t),chord:()=>this.generateChordExercise(t),rhythm:()=>this.generateRhythmExercise(t),melody:()=>this.generateMelodyExercise(t)}[e];if(!s)throw new Error(`Unknown exercise type: ${e}`);return this.currentExercise=s(),this.currentExercise}generateIntervalExercise(e){const t=this.getIntervalsForDifficulty(e),r=this.getRandomNote(),s=t[Math.floor(Math.random()*t.length)],n=this.applyInterval(r,s);return{type:"interval",difficulty:e,startNote:r,endNote:n,interval:s,answer:s.name,harmonic:Math.random()>.5}}generateChordExercise(e){const t=this.getChordsForDifficulty(e),r=this.getRandomNote(),s=t[Math.floor(Math.random()*t.length)],n=this.buildChord(r,s);return{type:"chord",difficulty:e,root:r,chordType:s,chord:n,answer:s.name}}generateRhythmExercise(e){const t=this.getMetersForDifficulty(e),r=t[Math.floor(Math.random()*t.length)],s=this.generateRhythmPattern(r,e);return{type:"rhythm",difficulty:e,meter:r,rhythm:s,answer:this.rhythmToString(s),tempo:this.options.tempo}}generateMelodyExercise(e){const t=this.getRandomKey(),r=this.generateMelody(t,e);return{type:"melody",difficulty:e,key:t,melody:r,answer:this.melodyToString(r)}}async playExercise(){if(!this.audioContext)throw new Error("AudioContext not initialized");if(!this.currentExercise)throw new Error("No exercise to play");this.audioContext.state==="suspended"&&await this.audioContext.resume();const t={interval:()=>this.playIntervalExercise(),chord:()=>this.playChordExercise(),rhythm:()=>this.playRhythmExercise(),melody:()=>this.playMelodyExercise()}[this.currentExercise.type];if(!t)throw new Error(`No player for exercise type: ${this.currentExercise.type}`);return t()}async playIntervalExercise(){const{startNote:e,endNote:t,harmonic:r}=this.currentExercise,s=this.audioContext.currentTime;r?(this.playNote(e.frequency,s,1),this.playNote(t.frequency,s,1)):(this.playNote(e.frequency,s,.5),this.playNote(t.frequency,s+.5,.5))}async playChordExercise(){const{chord:e}=this.currentExercise,t=this.audioContext.currentTime;e.forEach(r=>{this.playNote(r.frequency,t,1)})}async playRhythmExercise(){const{rhythm:e,tempo:t}=this.currentExercise,r=60/t,s=this.audioContext.currentTime;e.forEach((n,i)=>{n>0&&this.playNote(440,s+i*r,.1)})}async playMelodyExercise(){const{melody:e,tempo:t}=this.currentExercise,r=60/t,s=this.audioContext.currentTime;e.forEach((n,i)=>{n.frequency&&this.playNote(n.frequency,s+i*r,r)})}playNote(e,t,r){const s=this.audioContext.createOscillator(),n=this.audioContext.createGain();s.connect(n),n.connect(this.audioContext.destination),s.frequency.value=e,s.type="sine",n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(this.options.volume,t+.01),n.gain.exponentialRampToValueAtTime(.001,t+r),s.start(t),s.stop(t+r)}validateAnswer(e){if(!this.currentExercise)throw new Error("No exercise to validate");this.totalAttempts++;const t=this.compareAnswers(e,this.currentExercise.answer);return t?(this.score++,this.updateProgress(!0)):this.updateProgress(!1),{correct:t,userAnswer:e,correctAnswer:this.currentExercise.answer,score:this.score,totalAttempts:this.totalAttempts}}compareAnswers(e,t){const r=s=>s.toLowerCase().trim();return r(e)===r(t)}updateProgress(e){const t=`${this.exerciseType}_${this.difficulty}`,r=this.progress.get(t)||{correct:0,total:0};r.total++,e&&r.correct++,this.progress.set(t,r)}getProgress(){return{score:this.score,totalAttempts:this.totalAttempts,accuracy:this.totalAttempts>0?(this.score/this.totalAttempts*100).toFixed(1):0,progress:Object.fromEntries(this.progress)}}getIntervalsForDifficulty(e){const t={easy:[{name:"unison",semitones:0},{name:"major 2nd",semitones:2},{name:"major 3rd",semitones:4},{name:"perfect 4th",semitones:5},{name:"perfect 5th",semitones:7}],medium:[...this.getIntervalsForDifficulty("easy"),{name:"minor 2nd",semitones:1},{name:"minor 3rd",semitones:3},{name:"tritone",semitones:6},{name:"major 6th",semitones:9},{name:"minor 6th",semitones:8}],hard:[...this.getIntervalsForDifficulty("medium"),{name:"minor 7th",semitones:10},{name:"major 7th",semitones:11},{name:"octave",semitones:12},{name:"minor 9th",semitones:13},{name:"major 9th",semitones:14}]};return t[e]||t.easy}getChordsForDifficulty(e){const t={easy:[{name:"major",intervals:[0,4,7]},{name:"minor",intervals:[0,3,7]}],medium:[...this.getChordsForDifficulty("easy"),{name:"diminished",intervals:[0,3,6]},{name:"augmented",intervals:[0,4,8]}],hard:[...this.getChordsForDifficulty("medium"),{name:"major 7th",intervals:[0,4,7,11]},{name:"minor 7th",intervals:[0,3,7,10]},{name:"dominant 7th",intervals:[0,4,7,10]}]};return t[e]||t.easy}getMetersForDifficulty(e){const t={easy:["4/4","3/4"],medium:["4/4","3/4","2/4","6/8"],hard:["4/4","3/4","2/4","6/8","5/4","7/8"]};return t[e]||t.easy}getRandomNote(){const e=[{name:"C",frequency:261.63},{name:"D",frequency:293.66},{name:"E",frequency:329.63},{name:"F",frequency:349.23},{name:"G",frequency:392},{name:"A",frequency:440},{name:"B",frequency:493.88}];return e[Math.floor(Math.random()*e.length)]}applyInterval(e,t){const r=Math.pow(2,t.semitones/12);return{name:e.name,frequency:e.frequency*r}}buildChord(e,t){return t.intervals.map((r,s)=>{const n=Math.pow(2,r/12);return{name:this.getNoteName(e.frequency*n),frequency:e.frequency*n}})}generateRhythmPattern(e,t){const[r,s]=e.split("/").map(Number),n=[];for(let i=0;i<r;i++)t==="easy"?n.push(Math.random()>.3?1:0):t==="medium"?n.push(Math.random()>.2?1:0):Math.random()>.5?(n.push(1,.5),i+=.5):n.push(1);return n}getRandomKey(){const e=["C","G","D","A","E","F","Bb","Eb"];return e[Math.floor(Math.random()*e.length)]}generateMelody(e,t){const r=t==="easy"?4:t==="medium"?6:8,s=[],n=this.getScaleNotes(e);for(let i=0;i<r;i++){const o=Math.floor(Math.random()*n.length);s.push(n[o])}return s}getScaleNotes(e){const t={C:[261.63,293.66,329.63,349.23,392,440,493.88,523.25],G:[392,440,493.88,523.25,587.33,659.25,739.99,783.99],D:[293.66,329.63,369.99,392,440,493.88,554.37,587.33],A:[440,493.88,554.37,587.33,659.25,739.99,830.61,880],E:[329.63,369.99,415.3,440,493.88,554.37,622.25,659.25],F:[349.23,392,440,466.16,523.25,587.33,659.25,698.46],Bb:[233.08,261.63,293.66,311.13,349.23,392,440,466.16],Eb:[311.13,349.23,392,415.3,466.16,523.25,587.33,622.25]};return t[e]||t.C}getNoteName(e){const t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],s=12*Math.log2(e/440),n=Math.round(s+9)%12;return t[(n+12)%12]}rhythmToString(e){return e.map(t=>t>0?"x":"-").join(" ")}melodyToString(e){return e.map(t=>t.name||"rest").join(" ")}dispose(){this.audioContext&&(this.audioContext.close(),this.audioContext=null)}}class u{constructor(){this.navigation=new l,this.earTraining=new h,this.currentExercise=null,this.isPlaying=!1,this.init()}init(){this.setupEventListeners(),this.initializeControls(),this.hideComingSoonMessage()}setupEventListeners(){document.querySelectorAll(".exercise-type-btn").forEach(o=>{o.addEventListener("click",a=>{this.selectExerciseType(a.target.dataset.type)})}),document.querySelectorAll(".difficulty-btn").forEach(o=>{o.addEventListener("click",a=>{this.selectDifficulty(a.target.dataset.difficulty)})});const r=document.getElementById("play-exercise"),s=document.getElementById("submit-answer"),n=document.getElementById("new-exercise");r&&r.addEventListener("click",()=>this.playExercise()),s&&s.addEventListener("click",()=>this.submitAnswer()),n&&n.addEventListener("click",()=>this.generateNewExercise());const i=document.getElementById("answer-input");i&&i.addEventListener("keypress",o=>{o.key==="Enter"&&this.submitAnswer()})}initializeControls(){this.selectExerciseType("interval"),this.selectDifficulty("easy"),this.generateNewExercise()}hideComingSoonMessage(){const e=document.querySelector(".coming-soon-notice");e&&(e.style.display="none")}selectExerciseType(e){document.querySelectorAll(".exercise-type-btn").forEach(r=>{r.classList.toggle("active",r.dataset.type===e)}),this.generateNewExercise()}selectDifficulty(e){document.querySelectorAll(".difficulty-btn").forEach(r=>{r.classList.toggle("active",r.dataset.difficulty===e)}),this.generateNewExercise()}async generateNewExercise(){try{const e=document.querySelector(".exercise-type-btn.active")?.dataset.type||"interval",t=document.querySelector(".difficulty-btn.active")?.dataset.difficulty||"easy";this.currentExercise=this.earTraining.generateExercise(e,t),this.updateExerciseDisplay(),this.clearAnswer()}catch(e){console.error("Failed to generate exercise:",e),this.showError("Failed to generate exercise. Please try again.")}}async playExercise(){if(!this.isPlaying)try{this.isPlaying=!0,this.updatePlayButton("Playing..."),await this.earTraining.playExercise(),setTimeout(()=>{this.isPlaying=!1,this.updatePlayButton("Play Again")},2e3)}catch(e){console.error("Failed to play exercise:",e),this.showError("Failed to play exercise. Please check your audio settings."),this.isPlaying=!1,this.updatePlayButton("Play")}}submitAnswer(){const e=document.getElementById("answer-input");if(!e||!e.value.trim()){this.showError("Please enter an answer.");return}try{const t=this.earTraining.validateAnswer(e.value.trim());this.showResult(t),this.updateScoreDisplay(),t.correct&&setTimeout(()=>this.generateNewExercise(),2e3)}catch(t){console.error("Failed to validate answer:",t),this.showError("Failed to validate answer. Please try again.")}}updateExerciseDisplay(){const e=document.getElementById("exercise-type"),t=document.getElementById("exercise-difficulty"),r=document.getElementById("exercise-info");if(e&&(e.textContent=this.currentExercise.type.charAt(0).toUpperCase()+this.currentExercise.type.slice(1)),t&&(t.textContent=this.currentExercise.difficulty.charAt(0).toUpperCase()+this.currentExercise.difficulty.slice(1)),r){let s="";switch(this.currentExercise.type){case"interval":s=this.currentExercise.harmonic?"Harmonic interval":"Melodic interval";break;case"chord":s=`${this.currentExercise.chordType.name} chord`;break;case"rhythm":s=`${this.currentExercise.meter} meter at ${this.currentExercise.tempo} BPM`;break;case"melody":s=`Melody in ${this.currentExercise.key}`;break}r.textContent=s}}updatePlayButton(e){const t=document.getElementById("play-exercise");t&&(t.textContent=e,t.disabled=this.isPlaying)}clearAnswer(){const e=document.getElementById("answer-input");e&&(e.value="",e.focus());const t=document.getElementById("result-display");t&&(t.textContent="",t.className="result-display")}showResult(e){const t=document.getElementById("result-display");if(!t)return;t.textContent=e.correct?"✓ Correct!":`✗ Incorrect. The answer was: ${e.correctAnswer}`,t.className=`result-display ${e.correct?"correct":"incorrect"}`;const r=document.getElementById("answer-input");r&&(r.value="")}updateScoreDisplay(){const e=this.earTraining.getProgress(),t=document.getElementById("score-display"),r=document.getElementById("accuracy-display");t&&(t.textContent=`${e.score}/${e.totalAttempts}`),r&&(r.textContent=`${e.accuracy}%`)}showError(e){const t=document.getElementById("error-display");t&&(t.textContent=e,t.style.display="block",setTimeout(()=>{t.style.display="none"},3e3))}}document.addEventListener("DOMContentLoaded",()=>{new u});
