import{A as d,N as u}from"./Navigation-BNncwhjL.js";import{c,b as h}from"./AudioResourceManager-DnsOnIC-.js";class l{constructor(){this.audioContext=null,this.sounds={},this.pads=document.querySelectorAll(".beatbox-pad"),this.padQueue=[],this.padAnimationTimeouts=new Map,this.boundKeyHandler=t=>this.handleKeyTrigger(t),this.keyMap={KeyA:"kick",KeyS:"snare",KeyD:"hihat",KeyF:"cymbal"},this.startBtn=document.getElementById("beatbox-start"),this.stopBtn=document.getElementById("beatbox-stop"),this.tempoSlider=document.getElementById("beatbox-tempo"),this.tempoValue=document.getElementById("beatbox-tempo-value"),this.patternSelect=document.getElementById("beatbox-pattern"),this.gridContainer=document.getElementById("beatbox-grid-steps"),this.gridInfo=document.getElementById("beatbox-grid-info"),this.currentStep=0,this.isPlaying=!1,this.stepInterval=null,this.stepsPerBar=16,this.rows=["kick","snare","hihat","cymbal"],this.gridState=new Map,this.patterns=this.getPatternDefinitions(),this.init()}init(){this.setupAudioContext(),this.setupPads(),this.loadSounds(),this.attachKeyboardShortcuts(),this.buildGrid(),this.attachTransport(),this.applyPattern("default")}setupAudioContext(){this.audioContext=c()}setupPads(){this.pads.forEach((t,e)=>{const a=this.getSoundType(e);t.addEventListener("click",()=>this.playSound(a)),t.addEventListener("touchstart",s=>{s.preventDefault(),this.playSound(a)}),t.dataset.sound=a})}getSoundType(t){return["kick","snare","hihat","cymbal"][t]||"kick"}loadSounds(){this.sounds={kick:this.createKickSound(),snare:this.createSnareSound(),hihat:this.createHiHatSound(),cymbal:this.createCymbalSound()}}createKickSound(){return()=>{const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.frequency.setValueAtTime(60,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.5),e.gain.setValueAtTime(1,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.5),t.connect(e),e.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+.5)}}createSnareSound(){return()=>{const t=this.audioContext.sampleRate*.2,e=this.audioContext.createBuffer(1,t,this.audioContext.sampleRate),a=e.getChannelData(0);for(let i=0;i<t;i++)a[i]=(Math.random()*2-1)*Math.pow(1-i/t,2);const s=this.audioContext.createBufferSource(),n=this.audioContext.createGain();s.buffer=e,n.gain.setValueAtTime(.3,this.audioContext.currentTime),n.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.2),s.connect(n),n.connect(this.audioContext.destination),s.start()}}createHiHatSound(){return()=>{const t=this.audioContext.sampleRate*.1,e=this.audioContext.createBuffer(1,t,this.audioContext.sampleRate),a=e.getChannelData(0);for(let o=0;o<t;o++)a[o]=(Math.random()*2-1)*Math.pow(1-o/t,3);const s=this.audioContext.createBufferSource(),n=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();i.type="highpass",i.frequency.value=8e3,s.buffer=e,n.gain.setValueAtTime(.2,this.audioContext.currentTime),n.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.1),s.connect(i),i.connect(n),n.connect(this.audioContext.destination),s.start()}}createCymbalSound(){return()=>{const t=this.audioContext.sampleRate*.5,e=this.audioContext.createBuffer(1,t,this.audioContext.sampleRate),a=e.getChannelData(0);for(let o=0;o<t;o++)a[o]=(Math.random()*2-1)*Math.pow(1-o/t,1.5);const s=this.audioContext.createBufferSource(),n=this.audioContext.createGain(),i=this.audioContext.createBiquadFilter();i.type="bandpass",i.frequency.value=3e3,i.Q.value=1,s.buffer=e,n.gain.setValueAtTime(.1,this.audioContext.currentTime),n.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.5),s.connect(i),i.connect(n),n.connect(this.audioContext.destination),s.start()}}playSound(t){this.sounds[t]&&(this.sounds[t](),this.enqueuePadAnimation(t))}enqueuePadAnimation(t){const e=Array.from(this.pads).find(s=>s.dataset.sound===t);if(!e)return;this.padAnimationTimeouts.has(e)&&clearTimeout(this.padAnimationTimeouts.get(e)),e.style.transform="scale(0.95)",e.style.filter="brightness(1.5)";const a=setTimeout(()=>{e.style.transform="scale(1)",e.style.filter="brightness(1)",this.padAnimationTimeouts.delete(e)},120);this.padAnimationTimeouts.set(e,a)}attachKeyboardShortcuts(){window.addEventListener("keydown",this.boundKeyHandler)}handleKeyTrigger(t){const e=this.keyMap[t.code];e&&(t.preventDefault(),this.playSound(e),this.toggleGridStep(e,this.currentStep,!0))}buildGrid(){this.gridContainer&&(this.gridContainer.innerHTML="",this.rows.forEach(t=>{const e=document.createElement("div");e.className="grid-row";const a=document.createElement("div");a.className="grid-row-label",a.textContent=t;const s=document.createElement("div");s.className="grid-row-steps";for(let n=0;n<this.stepsPerBar;n++){const i=document.createElement("button");i.type="button",i.className="grid-step",i.dataset.row=t,i.dataset.step=n,i.addEventListener("click",()=>this.toggleGridStep(t,n)),s.appendChild(i)}e.appendChild(a),e.appendChild(s),this.gridContainer.appendChild(e)}))}toggleGridStep(t,e,a=null){const s=`${t}-${e}`,n=this.gridContainer?.querySelector(`.grid-step[data-row="${t}"][data-step="${e}"]`);if(!n)return;const i=a!==null?a:!this.gridState.get(s);this.gridState.set(s,i),n.classList.toggle("active",i)}attachTransport(){this.startBtn?.addEventListener("click",()=>this.startSequencer()),this.stopBtn?.addEventListener("click",()=>this.stopSequencer()),this.tempoSlider?.addEventListener("input",t=>{const e=Number(t.target.value);this.tempoValue&&(this.tempoValue.textContent=`${e} BPM`),this.isPlaying&&(this.stopSequencer(),this.startSequencer())}),this.patternSelect?.addEventListener("change",t=>{this.applyPattern(t.target.value)})}startSequencer(){if(this.isPlaying)return;this.audioContext||this.setupAudioContext(),this.audioContext.resume(),this.isPlaying=!0,this.currentStep=0;const e=6e4/Number(this.tempoSlider?.value||108)/4;this.stepInterval=setInterval(()=>this.advanceStep(),e),this.startBtn&&(this.startBtn.disabled=!0),this.stopBtn&&(this.stopBtn.disabled=!1)}stopSequencer(){this.isPlaying&&(this.isPlaying=!1,clearInterval(this.stepInterval),this.stepInterval=null,this.clearPlayhead(),this.startBtn&&(this.startBtn.disabled=!1),this.stopBtn&&(this.stopBtn.disabled=!0))}advanceStep(){this.clearPlayhead(),this.rows.forEach(t=>{const e=`${t}-${this.currentStep}`;this.gridState.get(e)&&this.playSound(t),this.gridContainer?.querySelector(`.grid-step[data-row="${t}"][data-step="${this.currentStep}"]`)?.classList.add("playhead")}),this.currentStep=(this.currentStep+1)%this.stepsPerBar}clearPlayhead(){this.gridContainer?.querySelectorAll(".grid-step.playhead").forEach(t=>t.classList.remove("playhead"))}applyPattern(t){const e=this.patterns[t]||this.patterns.default;this.gridState.clear(),this.gridContainer?.querySelectorAll(".grid-step").forEach(a=>a.classList.remove("active")),this.rows.forEach((a,s)=>{(e.steps[s]||[]).forEach(i=>this.toggleGridStep(a,i,!0))}),this.gridInfo&&(this.gridInfo.textContent=e.description)}getPatternDefinitions(){return{default:{steps:[[0,4,8,12],[4,12],[2,6,10,14],[0,8]],description:"Balanced 4/4 grid with kick on quarters and hats on the off-beats."},fibonacci:{steps:[[0,1,3,5,8,13],[5,8,13],[2,3,5,8,13],[1,4,7,11,14]],description:"Fibonacci spacing to create expanding syncopation (1-1-2-3-5-8)."},trinity:{steps:[[0,8],[4,12],[2,6,10,14],[3,9,15]],description:"3:2 polyrhythm where hi-hats trace triplets over duple kicks."},golden:{steps:[[0,7,11],[3,9,14],[2,5,8,13],[1,4,6,10,12,15]],description:"Golden ratio accents: 0/0.618/1 overlays for evolving shimmer."}}}dispose(){this.padAnimationTimeouts.forEach(t=>clearTimeout(t)),this.padAnimationTimeouts.clear(),window.removeEventListener("keydown",this.boundKeyHandler),this.stopSequencer(),h(this.audioContext),this.audioContext=null}}document.addEventListener("DOMContentLoaded",()=>{new d().init(),new u,new l});
